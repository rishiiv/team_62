WITH hourly AS ( SELECT DATE(order_datetime) AS day, EXTRACT(HOUR FROM order_datetime) AS hour_of_day, COUNT(*) AS order_count FROM sales_orders GROUP BY 1, 2 ), ranked AS ( SELECT day, hour_of_day, order_count, ROW_NUMBER() OVER (PARTITION BY day ORDER BY order_count DESC) AS rn FROM hourly ) SELECT day, hour_of_day AS busiest_hour, order_count FROM ranked WHERE rn = 1 ORDER BY day;